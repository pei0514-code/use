<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>麥麥商城票券使用指南</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- LIFF SDK -->
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
    .brand-btn { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
    .brand-btn:active { transform: scale(0.92); }
    .brand-btn.active { 
      border-color: #ef4444; 
      background-color: #fff; 
      box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.1); 
      ring: 4px;
      ring-color: rgba(239, 68, 68, 0.2);
    }
    .fade-in { animation: fadeIn 0.3s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .btn-glow {
      animation: glow 2s infinite;
    }
    @keyframes glow {
      0% { box-shadow: 0 0 5px rgba(239, 68, 68, 0.2); }
      50% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
      100% { box-shadow: 0 0 5px rgba(239, 68, 68, 0.2); }
    }
  </style>
</head>
<body class="antialiased select-none">
  <div class="max-w-md mx-auto min-h-screen bg-slate-50 shadow-2xl flex flex-col">
    
    <!-- 頁首：招呼語 -->
    <header class="bg-gradient-to-br from-red-600 to-orange-500 text-white p-8 pt-10 pb-16 rounded-b-[3.5rem] shadow-lg relative overflow-hidden">
      <div class="absolute -right-4 -top-4 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
      <div class="relative z-10">
        <p class="text-xs font-bold tracking-[0.2em] opacity-70 mb-2 uppercase">Mai Mai Store Guide</p>
        <h1 class="text-xl font-medium">
          親愛的 <span id="user-name" class="font-black border-b-2 border-yellow-300 pb-0.5 tracking-wide underline underline-offset-4 text-white">LINE 會員</span> 您好
        </h1>
        <h2 class="text-2xl font-black mt-4 leading-tight">請選擇您購買的商品種類</h2>
      </div>
    </header>

    <main class="px-6 -mt-8 flex-grow relative z-20">
      <!-- 品牌選擇按鈕區 - 4 欄佈局 -->
      <div class="grid grid-cols-4 gap-2 mb-8">
        <div onclick="selectBrand('mcd')" id="btn-mcd" class="brand-btn p-3 rounded-2xl bg-white border-2 border-transparent flex flex-col items-center justify-center gap-1 shadow-sm">
          <span class="text-2xl">🍔</span>
          <span class="text-[10px] font-bold text-slate-600">麥當勞</span>
        </div>
        <div onclick="selectBrand('kfc')" id="btn-kfc" class="brand-btn p-3 rounded-2xl bg-white border-2 border-transparent flex flex-col items-center justify-center gap-1 shadow-sm">
          <span class="text-2xl">🍗</span>
          <span class="text-[10px] font-bold text-slate-600">肯德基</span>
        </div>
        <div onclick="selectBrand('pzh')" id="btn-pzh" class="brand-btn p-3 rounded-2xl bg-white border-2 border-transparent flex flex-col items-center justify-center gap-1 shadow-sm">
          <span class="text-2xl">🍕</span>
          <span class="text-[10px] font-bold text-slate-600">必勝客</span>
        </div>
        <div onclick="selectBrand('sbx')" id="btn-sbx" class="brand-btn p-3 rounded-2xl bg-white border-2 border-transparent flex flex-col items-center justify-center gap-1 shadow-sm">
          <span class="text-2xl">☕</span>
          <span class="text-[10px] font-bold text-slate-600">星巴克</span>
        </div>
        <div onclick="selectBrand('mos')" id="btn-mos" class="brand-btn p-3 rounded-2xl bg-white border-2 border-transparent flex flex-col items-center justify-center gap-1 shadow-sm">
          <span class="text-2xl">🍱</span>
          <span class="text-[10px] font-bold text-slate-600">摩斯</span>
        </div>
        <div onclick="selectBrand('bk')" id="btn-bk" class="brand-btn p-3 rounded-2xl bg-white border-2 border-transparent flex flex-col items-center justify-center gap-1 shadow-sm">
          <span class="text-2xl">👑</span>
          <span class="text-[10px] font-bold text-slate-600">漢堡王</span>
        </div>
        <div onclick="selectBrand('coco')" id="btn-coco" class="brand-btn p-3 rounded-2xl bg-white border-2 border-transparent flex flex-col items-center justify-center gap-1 shadow-sm">
          <span class="text-2xl">🥤</span>
          <span class="text-[10px] font-bold text-slate-600">CoCo</span>
        </div>
        <div onclick="selectBrand('other')" id="btn-other" class="brand-btn p-3 rounded-2xl bg-white border-2 border-transparent flex flex-col items-center justify-center gap-1 shadow-sm">
          <span class="text-2xl">🎁</span>
          <span class="text-[10px] font-bold text-slate-600">其他商品</span>
        </div>
      </div>

      <!-- 動態內容區 -->
      <div id="content-area" class="min-h-[200px]">
        <div class="text-center py-12 bg-white/50 rounded-[3rem] border-2 border-dashed border-slate-200 mb-8">
          <p class="text-slate-400 font-medium text-sm">點擊上方品牌圖標<br>查看詳細使用說明</p>
        </div>
      </div>

      <!-- 注意事項 -->
      <section class="bg-amber-50 rounded-[2.5rem] p-7 border border-amber-100 shadow-sm mb-12">
        <h3 class="text-amber-800 font-black mb-4 flex items-center gap-2">
          <span class="bg-amber-200 w-8 h-8 flex items-center justify-center rounded-full text-base">📝</span>
          注意事項
        </h3>
        <ul class="text-[13px] text-amber-900/80 space-y-4 pl-5 list-decimal font-medium leading-relaxed">
          <li>請將截圖<span class="text-red-600 font-bold underline">保存下來</span>，期限為取得後約 <span class="font-bold underline">30天內</span> 兌換，請儘速使用。</li>
          <li>兌換時再開啟截圖畫面給櫃台人員或機台使用即可。</li>
          <li>請在<span class="text-red-700 font-bold">使用期限內</span>兌換完畢，逾期將失效恕無法補發或退款。</li>
          <li>本憑證每次交易可兌換 5 張，可多次重複使用。</li>
          <li>若於兌換前查詢或取消使用，序號將被鎖定 5 分鐘，請於 5 分鐘之後再進行兌換。</li>
        </ul>
      </section>
    </main>

    <footer class="text-center pb-8 opacity-20 text-[10px] tracking-widest font-bold">
      MAI MAI STORE • TICKET GUIDE 2025
    </footer>
  </div>

  <script>
    // 品牌資料定義
    const brandData = {
      mcd: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">🍔 麥當勞使用教學</h3>
            <div class="space-y-6 text-[14px] text-slate-600">
              <section>
                <h4 class="font-bold text-red-600">● 櫃檯/得來速：</h4>
                <p>告知店員欲使用電子券，並提供截圖掃描。</p>
              </section>
              <section class="bg-red-50 p-4 rounded-2xl border border-red-100">
                <h4 class="font-bold text-red-700 mb-2">● 自助點餐機：</h4>
                <p class="text-xs leading-relaxed">點選開始 → 用餐方式 → 左上角選「電子商品卷」 → 掃描截圖畫面 → 確認餐點。</p>
              </section>
              <a href="https://www.edenred.com.tw/store/mcdonalds/" target="_blank" class="block text-center py-4 bg-red-600 border-2 border-red-700 rounded-2xl text-lg font-black text-white shadow-lg btn-glow">📍 查詢不適用門市 (大字)</a>
            </div>
          </div>
        `
      },
      kfc: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">🍗 肯德基使用教學</h3>
            <div class="space-y-6 text-[14px] text-slate-600">
              <section>
                <h4 class="font-bold text-red-800 underline underline-offset-4 mb-2">官網預訂快取：</h4>
                <p>至「優惠券」區輸入 20 碼序號兌換。</p>
                <a href="https://www.kfcclub.com.tw/Coupon" target="_blank" class="inline-block mt-2 text-blue-600 font-bold underline">→ 前往官網兌換</a>
              </section>
              <section>
                <h4 class="font-bold text-red-800 underline underline-offset-4 mb-2">門市現場：</h4>
                <p>出示截圖，請人員點選「兌換掃券」按鍵。</p>
              </section>
              <a href="https://www.edenred.com.tw/store/kfc/" target="_blank" class="block text-center py-4 bg-red-800 border-2 border-red-900 rounded-2xl text-lg font-black text-white shadow-lg btn-glow">📍 查詢不適用門市 (大字)</a>
            </div>
          </div>
        `
      },
      pzh: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">🍕 必勝客使用教學</h3>
            <div class="space-y-6 text-[14px] text-slate-600">
              <section>
                <h4 class="font-bold text-orange-600 underline underline-offset-4 mb-2">官網兌換：</h4>
                <p>點選「優惠券兌換」→「輸入電子禮券序號」(VP開頭20碼)。</p>
              </section>
              <section>
                <h4 class="font-bold text-orange-600 underline underline-offset-4 mb-2">現場/電話：</h4>
                <p>出示截圖或撥打 412-9889 告知 20 碼序號。</p>
              </section>
              <a href="https://www.edenred.com.tw/store/phtmenu/" target="_blank" class="block text-center py-4 bg-orange-600 border-2 border-orange-700 rounded-2xl text-lg font-black text-white shadow-lg btn-glow">📍 查詢不適用門市 (大字)</a>
            </div>
          </div>
        `
      },
      sbx: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">☕ 星巴克使用教學</h3>
            <div class="space-y-6 text-[14px] text-slate-600">
              <p>● 結帳前出示截圖，供櫃台店員掃描條碼即可兌換。</p>
              <p class="text-xs text-slate-400 italic">※ 不適用於線上點餐或外送服務。</p>
              <a href="https://www.edenred.com.tw/store/starbucks/" target="_blank" class="block text-center py-4 bg-green-700 border-2 border-green-800 rounded-2xl text-lg font-black text-white shadow-lg btn-glow">📍 查詢不適用門市 (大字)</a>
            </div>
          </div>
        `
      },
      mos: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">🍱 摩斯漢堡使用教學</h3>
            <div class="space-y-6 text-[14px] text-slate-600">
              <p>● 於全台摩斯漢堡櫃檯出示「<span class="font-bold text-green-700 underline">手機截圖</span>」給店員掃瞄即可兌換。</p>
              <a href="https://www.edenred.com.tw/store/mosburger/" target="_blank" class="block text-center py-4 bg-green-600 border-2 border-green-700 rounded-2xl text-lg font-black text-white shadow-lg btn-glow">📍 查詢不適用門市 (大字)</a>
            </div>
          </div>
        `
      },
      bk: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in border-l-8 border-orange-800">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">👑 漢堡王使用教學</h3>
            <div class="space-y-4 text-[14px] text-slate-600">
              <p>● 請於結帳前主動出示「<span class="font-bold text-orange-800 underline">電子券截圖</span>」，供櫃台人員點選「電子商品券」按鍵並掃描條碼。</p>
            </div>
          </div>
        `
      },
      coco: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in border-l-8 border-orange-400">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">🥤 CoCo使用教學</h3>
            <div class="space-y-4 text-[14px] text-slate-600">
              <p>● 至門市點餐後，出示「<span class="font-bold text-orange-500 underline">商品截圖</span>」提供給店員掃瞄核銷即可領取飲品。</p>
            </div>
          </div>
        `
      },
      other: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in border-l-8 border-blue-500">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">🎁 其他商品使用教學</h3>
            <div class="space-y-4 text-[14px] text-slate-600 font-medium">
              <p class="leading-relaxed">● 其他品牌票券使用方式，請 <span class="text-blue-600 font-bold underline">依客服指示</span> 或參考商品描述 <span class="text-blue-600 font-bold underline">自行使用</span>。</p>
              <p class="text-xs text-slate-400 italic">※ 若有任何疑問，請聯繫商城線上客服諮詢。</p>
            </div>
          </div>
        `
      }
    };

    // 切換品牌邏輯
    function selectBrand(id) {
      document.querySelectorAll('.brand-btn').forEach(btn => btn.classList.remove('active', 'ring-4', 'ring-red-100', 'border-red-500'));
      const activeBtn = document.getElementById('btn-' + id);
      activeBtn.classList.add('active', 'ring-4', 'ring-red-100', 'border-red-500');

      const contentArea = document.getElementById('content-area');
      contentArea.innerHTML = brandData[id].html;
      
      window.scrollTo({ top: activeBtn.offsetTop - 20, behavior: 'smooth' });
    }

    // 強化版姓名抓取邏輯
    async function updateUserName() {
      const nameEl = document.getElementById('user-name');
      if (!nameEl) return false;

      try {
        // 1. 優先嘗試 Profile API
        const profile = await liff.getProfile();
        if (profile && profile.displayName) {
          nameEl.textContent = profile.displayName;
          return true;
        }

        // 2. 備援嘗試 ID Token
        const idToken = liff.getDecodedIDToken();
        if (idToken && (idToken.name || idToken.displayName)) {
          nameEl.textContent = idToken.name || idToken.displayName;
          return true;
        }
      } catch (e) {
        console.error("抓取名稱失敗:", e);
      }
      return false;
    }

    // 初始化 LIFF
    async function initLiff() {
      const nameEl = document.getElementById('user-name');
      try {
        await liff.init({ liffId: '2006813350-B66g1l4n' });
        await liff.ready;

        if (!liff.isLoggedIn()) {
          if (liff.isInClient()) {
            liff.login();
          } else {
            nameEl.textContent = "貴賓";
          }
          return;
        }

        // 初次嘗試更新姓名
        const success = await updateUserName();
        
        // 如果失敗，開啟定時重試 (解決部分設備初始化延遲)
        if (!success || nameEl.textContent === "LINE 會員") {
          let retryCount = 0;
          const timer = setInterval(async () => {
            const ok = await updateUserName();
            retryCount++;
            if (ok || retryCount > 5) clearInterval(timer);
          }, 800);
        }

      } catch (e) {
        console.error("LIFF 初始化失敗:", e);
        if(nameEl) nameEl.textContent = "LINE 會員";
      }
    }

    window.onload = initLiff;
  </script>
</body>
</html>
