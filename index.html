<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>麥麥商城票券使用指南</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- LIFF SDK -->
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
    .brand-btn { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
    .brand-btn:active { transform: scale(0.92); }
    .brand-btn.active { 
      border-color: #ef4444; 
      background-color: #fff; 
      box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.1); 
      ring: 4px;
      ring-color: rgba(239, 68, 68, 0.2);
    }
    .fade-in { animation: fadeIn 0.3s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="antialiased select-none">
  <div class="max-w-md mx-auto min-h-screen bg-slate-50 shadow-2xl flex flex-col">
    
    <!-- 頁首：招呼語 -->
    <header class="bg-gradient-to-br from-red-600 to-orange-500 text-white p-8 pt-10 pb-16 rounded-b-[3.5rem] shadow-lg relative overflow-hidden">
      <div class="absolute -right-4 -top-4 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
      <div class="relative z-10">
        <p class="text-xs font-bold tracking-[0.2em] opacity-70 mb-2 uppercase">Mai Mai Store Guide</p>
        <h1 class="text-xl font-medium">
          親愛的 LINE 會員 <span id="user-name" class="font-black border-b-2 border-yellow-300 pb-0.5 tracking-wide">讀取中...</span> 您好
        </h1>
        <h2 class="text-2xl font-black mt-4 leading-tight">請選擇您購買的商品種類</h2>
      </div>
    </header>

    <main class="px-6 -mt-8 flex-grow relative z-20">
      <!-- 品牌選擇按鈕區 -->
      <div class="grid grid-cols-2 gap-4 mb-8">
        <div onclick="selectBrand('mcd')" id="btn-mcd" class="brand-btn p-5 rounded-[2.5rem] bg-white border-2 border-transparent flex flex-col items-center justify-center gap-2 shadow-sm">
          <span class="text-4xl">🍔</span>
          <span class="text-sm font-bold text-slate-600">麥當勞</span>
        </div>
        <div onclick="selectBrand('kfc')" id="btn-kfc" class="brand-btn p-5 rounded-[2.5rem] bg-white border-2 border-transparent flex flex-col items-center justify-center gap-2 shadow-sm">
          <span class="text-4xl">🍗</span>
          <span class="text-sm font-bold text-slate-600">肯德基</span>
        </div>
        <div onclick="selectBrand('pzh')" id="btn-pzh" class="brand-btn p-5 rounded-[2.5rem] bg-white border-2 border-transparent flex flex-col items-center justify-center gap-2 shadow-sm">
          <span class="text-4xl">🍕</span>
          <span class="text-sm font-bold text-slate-600">必勝客</span>
        </div>
        <div onclick="selectBrand('sbx')" id="btn-sbx" class="brand-btn p-5 rounded-[2.5rem] bg-white border-2 border-transparent flex flex-col items-center justify-center gap-2 shadow-sm">
          <span class="text-4xl">☕</span>
          <span class="text-sm font-bold text-slate-600">星巴克</span>
        </div>
      </div>

      <!-- 動態內容區 -->
      <div id="content-area" class="min-h-[200px]">
        <div class="text-center py-16 bg-white/50 rounded-[3rem] border-2 border-dashed border-slate-200 mb-8">
          <p class="text-slate-400 font-medium text-sm">點擊上方品牌圖標<br>查看詳細使用說明</p>
        </div>
      </div>

      <!-- 注意事項 -->
      <section class="bg-amber-50 rounded-[2.5rem] p-7 border border-amber-100 shadow-sm mb-12">
        <h3 class="text-amber-800 font-black mb-4 flex items-center gap-2">
          <span class="bg-amber-200 w-8 h-8 flex items-center justify-center rounded-full text-base">📝</span>
          注意事項
        </h3>
        <ul class="text-[13px] text-amber-900/80 space-y-4 pl-5 list-decimal font-medium leading-relaxed">
          <li>請將截圖<span class="text-red-600 font-bold underline">保存下來</span>，期限為取得後約 <span class="font-bold underline">30天內</span> 兌換，請儘速使用。</li>
          <li>兌換時再開啟截圖畫面給櫃台人員或機台使用即可。</li>
          <li>請在<span class="text-red-700 font-bold">使用期限內</span>兌換完畢，逾期將失效恕無法補發或退款。</li>
          <li>本憑證每次交易可兌換 5 張，可多次重複使用。</li>
          <li>若於兌換前查詢或取消使用，序號將被鎖定 5 分鐘，請於 5 分鐘之後再進行兌換。</li>
        </ul>
      </section>
    </main>

    <footer class="text-center pb-8 opacity-20 text-[10px] tracking-widest font-bold">
      MAI MAI STORE • TICKET GUIDE 2025
    </footer>
  </div>

  <script>
    // 品牌資料定義
    const brandData = {
      mcd: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">🍔 麥當勞使用教學</h3>
            <div class="space-y-6 text-[14px] text-slate-600">
              <section>
                <h4 class="font-bold text-red-600 mb-1">一、櫃檯使用：</h4>
                <p>告知店員欲使用電子商品券，提供截圖給店員掃描。</p>
              </section>
              <section>
                <h4 class="font-bold text-red-600 mb-1">二、得來速使用：</h4>
                <p>告知點餐對講機欲使用電子券，再到下一窗口提供截圖掃描。</p>
              </section>
              <section class="bg-red-50 p-5 rounded-2xl border border-red-100">
                <h4 class="font-bold text-red-700 mb-3">三、自助點餐機流程：</h4>
                <div class="space-y-2 pl-2 border-l-2 border-red-200">
                  <p>1. 點選開始 → 選擇用餐方式(外帶/內用)</p>
                  <p>2. 左上角選「<span class="font-bold text-red-600">電子商品卷</span>」</p>
                  <p>3. 請掃描電子商品卷 (打開截圖放掃描區)</p>
                  <p>4. 確認餐點 (<span class="italic">1次最多掃5張，可重複多次</span>)</p>
                </div>
              </section>
            </div>
          </div>
        `
      },
      kfc: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">🍗 肯德基使用教學</h3>
            <div class="space-y-6 text-[14px] text-slate-600">
              <section>
                <h4 class="font-bold text-red-800 mb-2">1. 肯德基官網兌換：</h4>
                <p>至肯德基官網【優惠券】區輸入序號即可兌換。建議使用【預訂快取】專屬通道取餐。</p>
                <a href="https://www.kfcclub.com.tw/Coupon" target="_blank" class="inline-block mt-2 text-blue-600 font-bold underline">→ 前往官網兌換</a>
              </section>
              <section>
                <h4 class="font-bold text-red-800 mb-2">2. 門市兌換：</h4>
                <p>告知人員選擇「<span class="font-bold">兌換掃券</span>」按鍵進行核銷。不接受手抄或口說序號。</p>
                <p class="text-xs text-slate-400 mt-2 italic">※ 亦可使用自助點餐機兌換。</p>
              </section>
              <section class="bg-slate-50 p-4 rounded-xl">
                <p class="text-xs text-slate-500 font-medium leading-relaxed mb-1">⚠️ 注意事項：</p>
                <p class="text-[11px] text-slate-400">外送服務、點餐車道不適用。部分門市不參與兌換，請參考：</p>
                <a href="https://www.edenred.com.tw/index.php/store/kfc/" target="_blank" class="text-[11px] text-blue-500 underline">不適用門市清單</a>
              </section>
            </div>
          </div>
        `
      },
      pzh: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">🍕 必勝客使用教學</h3>
            <div class="space-y-6 text-[14px] text-slate-600">
              <section>
                <h4 class="font-bold text-orange-600 mb-1">● 官網及APP兌換：</h4>
                <p>官網左上角「優惠券兌換」→「輸入電子禮券序號」，輸入 <span class="font-mono bg-slate-100 px-1 border">VP</span> 開頭 20 碼英數字。</p>
              </section>
              <section>
                <h4 class="font-bold text-orange-600 mb-1">● 門市現場兌換：</h4>
                <p>結帳前出示截圖，告知人員選擇「<span class="font-bold">兌換掃券</span>」按鍵核銷。不接受口說序號。</p>
              </section>
              <section>
                <h4 class="font-bold text-orange-600 mb-1">● 電話訂餐：</h4>
                <p>撥打 412-9889，告知使用電子禮券並報完整 <span class="font-bold underline">20 碼序號</span>。取餐時需出示截圖。</p>
              </section>
            </div>
          </div>
        `
      },
      sbx: {
        html: `
          <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100 mb-6 fade-in">
            <h3 class="text-lg font-black text-slate-800 mb-5 flex items-center gap-2">☕ 星巴克使用教學</h3>
            <div class="space-y-4 text-[14px] text-slate-600">
              <section>
                <h4 class="font-bold text-green-800 mb-2">櫃檯直接使用：</h4>
                <p class="leading-relaxed">告知店員欲使用電子商品券，開啟手機截圖提供店員掃描掃碼核銷即可。</p>
              </section>
              <div class="bg-green-50 p-4 rounded-xl border border-green-100 mt-4">
                <p class="text-xs text-green-700 italic leading-relaxed">※ 電子商品券目前僅限於櫃台兌換，暫無法使用在線上點餐或外送服務。</p>
              </div>
            </div>
          </div>
        `
      }
    };

    // 切換品牌邏輯
    function selectBrand(id) {
      document.querySelectorAll('.brand-btn').forEach(btn => btn.classList.remove('active', 'ring-4', 'ring-red-100', 'border-red-500'));
      const activeBtn = document.getElementById('btn-' + id);
      activeBtn.classList.add('active', 'ring-4', 'ring-red-100', 'border-red-500');

      const contentArea = document.getElementById('content-area');
      contentArea.innerHTML = brandData[id].html;
      
      // 平滑捲動至內容區
      window.scrollTo({ top: activeBtn.offsetTop - 20, behavior: 'smooth' });
    }

    // 初始化 LIFF 且強化姓名讀取
    async function initLiff() {
      const nameEl = document.getElementById('user-name');
      try {
        // 初始化 LIFF
        await liff.init({ liffId: '2006813350-B66g1l4n' }); 
        
        // 檢查登入狀態
        if (!liff.isLoggedIn()) {
          if (liff.isInClient()) {
            liff.login();
          } else {
            nameEl.innerText = "貴賓";
          }
          return;
        }

        // 已登入，讀取個人資料
        const profile = await liff.getProfile();
        if (profile && profile.displayName) {
          nameEl.innerText = profile.displayName;
        } else {
          // 備援方案：從 ID Token 中讀取
          const idToken = liff.getDecodedIDToken();
          if (idToken && idToken.name) {
            nameEl.innerText = idToken.name;
          } else {
            nameEl.innerText = "LINE 會員";
          }
        }
      } catch (e) {
        console.error("LIFF 讀取失敗:", e);
        nameEl.innerText = "LINE 會員";
      }
    }

    // 當頁面載入完成時啟動
    window.onload = initLiff;
  </script>
</body>
</html>
